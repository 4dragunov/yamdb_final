#
![Build Status](https://github.com/4dragunov/yamdb_final/workflows/yambd-workflow/badge.svg)

### Описание проекта
Проект YaMDb собирает отзывы пользователей на произведения. Произведения делятся на категории: «Книги», «Фильмы», «Музыка».
Приложение написано на основе `fullREST` архитектуры на фреймворке `django-rest-framework`. База данных `postgresssql`.
<br><br>Проект доступен по адресу: http://84.252.128.33 <br>
Документация: http://84.252.128.33/redoc/

В корне проекта файл `entrypoint.sh
` собирает статику и выполняет миграции. 

### Ручная установка
### Развертывание проекта
#### 0. Клонируйте репозиторий на локальную машину  
```
https://github.com/4dragunov/infra_sp2.git
```



#### 1. Установка ПО docker и docker-compose
Для запуска проекта необходима установка программ `docker` и `docker-compose`. https://docs.docker.com/engine/install/
#### 2. Создание .ENV файла
Создайте файл .env
 с переменными окружения для работы с базой данных на основе шаблона
```
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД 
```
#### 3. Создание образа и запуск контейнера
```
docker-compose up --build -d
```
#### 4. Создание и применение миграций базы данных
Необходимо зайти в контейнер командой:
```
docker-compose exec web bash
```
Создать и применить миграции
```
python manage.py makemigrations
python manage.py migrate
```
#### 5. Загрузка фикстур (тестовых данных) в базу данных
Файл JSON с данными загружается следующей командой:
```
python manage.py loaddata fixtures.json
```
#### 6. Создание суперпользователя
```python manage.py createsuperuser```

#### 7. Выход из контейнера и остановка 
```
exit
docker-compose down
``````

### Использованные технологии
Django Rest Framework https://www.django-rest-framework.org/ <br>
Django https://www.djangoproject.com/ <br>
PostgreSQL https://www.postgresql.org/ <br>
Docker https://www.docker.com/ <br>

### Запуск тестов
В терминале или командной строке перейдите в директорию проекта (она содержит этот readme файл).
<br>Выполните команды:
```
pip install pytest #Если pytest не установлен
```
Запустите тесты
```
pytest
```

### Авторы проекта
Алексей Драгунов - Python Developer
Евгения Самсонова - Python Developer
Алексей Сухачевский - Python Developer

### Лицензии
Этот проект, включая все файлы и их содержимое, лицензирован в соответствии с условиями лицензии MIT.
Смотрите LICENSE.txt для деталей.

### Документация
Документация доступна по адресу: your-ip-address:8000/redoc а также ниже:

#### Алгоритм регистрации пользователей
- Пользователь отправляет запрос с параметром email на /auth/email/.
- YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email .
- Пользователь отправляет запрос с параметрами email и confirmation_code на /auth/token/, в ответе на запрос ему приходит token (JWT-токен).
- При желании пользователь отправляет PATCH-запрос на /users/me/ и заполняет поля в своём профайле (описание полей — в документации).

#### Пользовательские роли
- Аноним — может просматривать описания произведений, читать отзывы и комментарии.
- Аутентифицированный пользователь — может, как и Аноним, читать всё, дополнительно он может публиковать отзывы и ставить рейтинг произведениям (фильмам/книгам/песенкам), может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять свои отзывы и комментарии.
- Модератор — те же права, что и у Аутентифицированного пользователя плюс право удалять любые отзывы и комментарии.
- Администратор — полные права на управление проектом и всем его содержимым. Может создавать и удалять категории и произведения. Может назначать роли пользователям.
- Администратор Django — те же права, что и у роли Администратор.

#### Authentication
Security Scheme Type	API Key
Header parameter name:	Bearer
#### Ресурсы API YaMDb
 - Ресурс AUTH: аутентификация.
- Ресурс USERS: пользователи.
- Ресурс TITLES: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- Ресурс CATEGORIES: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- Ресурс GENRES: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс REVIEWS: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс COMMENTS: комментарии к отзывам. Комментарий привязан к определённому отзыву.

#### Связанные данные и каскадное удаление
- При удалении объекта пользователя User должны удаляться все отзывы и комментарии этого пользователя (вместе с оценками-рейтингами).
- При удалении объекта произведения Title должны удаляться все отзывы к этому произведению и комментарии к ним.
- При удалении объекта категории Category не удалять связанные с этой категорией произведения (Title).
- При удалении объекта жанра Genre не удалять связанные с этим жанром произведения (Title).
- При удалении объекта отзыва Review должны быть удалены все комментарии к этому отзыву.

### Модели
#### AUTH - Аутентификация
- GET Получение JWT-токена в обмен на email и confirmation code
  - - /api/v1/auth/token/
- POST Отправление confirmation_code на переданный email.
  - - /api/v1/auth/email/
#### USERS - Пользователи
- GET Получить список всех пользователей.
  - - /api/v1/users/
  - - Права доступа: Администратор
- POST Создание пользователя.
  - - /api/v1/auth/email/
  - - Права доступа: Администратор
- GET Получить пользователя по username.
  - - /api/v1/users/{username}/
  - - Права доступа: Администратор
- PATCH Изменить данные пользователя по username.
  - - /api/v1/users/{username}/
  - - Права доступа: Администратор
- DEL Удалить пользователя по username. 
  - - /api/v1/users/{username}/
  - - Права доступа: Администратор
- GET Получить данные своей учетной записи.
  - - /api/v1/users/me/
  - - Права доступа: Любой авторизованный пользователь
- PATCH Изменить данные своей учетной записи.
  - - /api/v1/users/me/
  - - Права доступа: Любой авторизованный пользователь
#### REVIEWS - Отзывы
- GET Получить список всех отзывов. 
  - - /api/v1/titles/{title_id}/reviews/
  - - Права доступа: Доступно без токена.
- POST Создать новый отзыв.
  - - /api/v1/titles/{title_id}/reviews/
  - - Права доступа: Аутентифицированные пользователи.
- GET Получить отзыв по id.
  - - /api/v1/titles/{title_id}/reviews/{review_id}/
  - - Права доступа: Доступно без токена.
- PATCH Частично обновить отзыв по id.
  - - /api/v1/titles/{title_id}/reviews/{review_id}/
  - - Права доступа: Автор отзыва, модератор или администратор.
- DEL Удалить отзыв по id.
  - - /api/v1/titles/{title_id}/reviews/{review_id}/
  - - Права доступа: Автор отзыва, модератор или администратор.

#### COMMENTS - Комментарии к отзывам
 - GET Получить список всех комментариев к отзыву по id.
   - - /api/v1/titles/{title_id}/reviews/{review_id}/comments/
   - - Права доступа: Доступно без токена.
 - POST Создать новый комментарий для отзыва.
   - - /api/v1/titles/{title_id}/reviews/{review_id}/comments/
   - - Права доступа: Аутентифицированные пользователи.
 - GET Получить комментарий для отзыва по id.
   - - /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
   - - Права доступа: Доступно без токена.
 - PATCH Частично обновить комментарий к отзыву по id.
   - - /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
   - - Права доступа: Автор комментария, модератор или администратор.
 - DEL Удалить комментарий к отзыву по id.
   - - /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
   - - Права доступа: Автор комментария, модератор или администратор.
#### CATEGORIES - Категории (типы) произведений
  - GET Получить список всех категорий.
    - - /api/v1/categories/
    - - Права доступа: Доступно без токена
  - POST Создать категорию.
    - - /api/v1/categories/
    - - Права доступа: Администратор.
  - DEL Удалить категорию. 
    - - /api/v1/categories/{slug}/
    - - Права доступа: Администратор.
 #### GENRES - Категории жанров
  - GET Получить список всех жанров.
    - - /api/v1/genres/
    - - Права доступа: Доступно без токена
  - POST Создать жанр. 
    - - /api/v1/genres/
    - - Права доступа: Администратор.
  - DEL Удалить жанр.
    - - /api/v1/genres/{slug}/
    - - Права доступа: Администратор.
 #### TITLES - Произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
  - GET Получить список всех объектов.
    - - /api/v1/titles/
    - - Права доступа: Доступно без токена
  - POST Создать произведение для отзывов.
    - - /api/v1/titles/
    - - Права доступа: Администратор.
  - GET Информация об объекте.
    - - /api/v1/titles/{titles_id}/
    - - Права доступа: Доступно без токена.
  - PATCH Обновить информацию об объекте.
    - - /api/v1/titles/{titles_id}/
    - - Права доступа: Администратор
  - DEL Удалить произведение. 
    - - /api/v1/titles/{titles_id}/
    - - Права доступа: Администратор.




